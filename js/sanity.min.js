function googleOnLoadCallback(){angular.bootstrap(document,["sanityApp"])}(function(){function a(){var b=this;this.clientId="950592637430.apps.googleusercontent.com",this.apiKey="AIzaSyCs378KoxX1cX5_TTa5W65tTG396AkId0A",this.scopes="https://www.googleapis.com/auth/youtube",this.gapi=gapi,this.q={},this.connect=function(){var a=b.q.defer();return this.gapi.auth.authorize({client_id:this.clientId,scope:this.scopes,immediate:!1},function(c){c&&!c.error?b.gapi.client.load("youtube","v3",function(b){a.resolve(b)}):a.reject()}),a.promise},this.checkAuth=function(){return this.connect()},this.authorize=function(){return this.connect()},this.load=function(){this.gapi.load(),this.gapi.client.setApiKey(this.apiKey)},this.$get=["$q",function(b){var c=new a;return c.q=b,c}]}angular.module("googleAPI",[]),angular.module("googleAPI").provider("googleApi",a)})(),function(){function a(a,b){var c=this;this.get=function(d,e){var f=a.defer();return b.gapi.client.setApiKey(b.apiKey),typeof b.gapi.client.youtube!="undefined"?b.gapi.client.youtube[d].list(e).execute(function(a){c.convertItems(a).then(function(a){f.resolve(a)})}):f.reject(),f.promise},this.convertItems=function(b){var c=a.defer(),d=[];return angular.forEach(b.items,function(c,e){var f=a.defer();d.push(f.promise),b.items[e]._id=b.items[e].id,delete b.items[e].id,f.resolve()}),a.all(d).then(function(){c.resolve(b)}),c.promise},this.subscriptions=function(a){var b={part:"snippet",mine:!0,maxResults:50};return typeof a!="undefined"&&a!==null&&(b.page=a),c.get("subscriptions",b)},this.channels=function(a){var b={part:"snippet",mine:!0,maxResults:50};return typeof a!="undefined"&&a!==null&&(b.page=a),c.get("channels",b)},this.channelvideos=function(a){return c.get("activities",{part:"contentDetails",channelId:a,maxResults:20})},this.videos=function(b){var d=a.defer();return c.get("videos",{part:"snippet,contentDetails,status,statistics",mine:!0,id:b.join()}).then(function(a){typeof a.items=="undefined"?d.reject():c.convertItems(a).then(function(a){d.resolve(a.items)})},function(){d.reject()}),d.promise}}angular.module("youtube",["googleAPI"]),a.$inject=["$q","googleApi"],angular.module("youtube").service("ytData",a)}(),function(){function a(a,b,c,d,e,f,g,h){return{migrateOldLS:function(){}}}function b(a,b,c,d,e){return{init:function(){var d=b.defer();return c.init().then(function(){a.userid=c.current,d.resolve()}),d.promise},update:function(){var a=b.defer();return e.pageChannels().then(function(){d.loadVideos().then(function(){d.load().then(function(){a.resolve(d.countLastAdded)})})}),a.promise}}}function c(a,b,c){return{master:c("ytSanityDB/v1"),data:null,current:"",init:function(c){var d=a.defer(),e=this;return typeof c=="undefined"&&(c=null),b.channels().then(function(a){e.master.get(a.items[0]._id).then(function(a){e.createDB(a._id).then(function(){d.resolve()})},function(){e.master.put(a.items[0]).then(function(b){e.current=a.items[0]._id,e.createDB(res._id).then(function(){d.resolve()})})})},function(){d.reject()}),d.promise},createDB:function(b){var d=a.defer(),e={_id:"_design/ytsanegrid",views:{videos:{map:function(a){a.kind==="youtube#video"&&emit(a._id,{_id:a._id+"__meta",link:"https://www.youtube.com/watch?v="+a._id,title:a.snippet.title,thumbnail:{"default":a.snippet.thumbnails.default.url,medium:a.snippet.thumbnails.medium.url,high:a.snippet.thumbnails.high.url},channelId:a.snippet.channelId,author:a.snippet.channelTitle,authorlink:"https://www.youtube.com/channel/"+a.snippet.channelId,published:a.snippet.publishedAt,duration:a.contentDetails.duration})}.toString()},channels:{map:function(a){a.kind==="youtube#subscription"&&emit(a._id,a)}.toString()}}};return self.current=b,self.data=c("ytSanityDB/v1/"+b),self.data.get(e._id).then(function(a){},function(){self.data.put(e).then(function(){d.resolve()})}),d.promise}}}function d(a,b,c,d,e,f){return{list:[],countLastAdded:0,load:function(){var c=a.defer(),d=this;return e.data.query("videos",{include_docs:!0}).then(function(a){d.list=a.rows,b.$broadcast("videos:updated"),c.resolve()}),c.promise},loadVideos:function(){var b=a.defer(),c=[],d=this;return this.countLastAdded=0,e.data.query("channels",{include_docs:!0}).then(function(b){angular.forEach(b.rows,function(b){var e=a.defer();c.push(e),d.channelVideos(b.doc.channelId).then(function(){e.resolve()},function(){e.resolve()})})}),a.all(c).then(function(){b.resolve()}),b.promise},channelVideos:function(b){var d=a.defer(),e=this;return c.channelvideos(b).then(function(a){return e.pushVideos(a.items)}).then(function(){d.resolve()},function(){d.reject()}),d.promise},pushVideos:function(b){var c=a.defer(),d=this;return typeof b!="undefined"?d.extractVideoIds(b).then(function(a){return d.pushVideoIds(a)}).then(function(a){c.resolve(a)}):c.reject(),c.promise},extractVideoIds:function(b){var c=a.defer(),d=[],e=b.length-1;for(var f=0;f<b.length;f++){if(typeof b[f].contentDetails=="undefined")continue;typeof b[f].contentDetails.upload!="undefined"?(d.push(b[f].contentDetails.upload.videoId),f===e&&c.resolve(d)):f===e&&c.resolve(d)}return c.promise},pushVideoIds:function(b){var d=a.defer(),f=this;return c.videos(b).then(function(b){var c=[];angular.forEach(b,function(b){var d=a.defer();c.push(d),e.data.get(b._id).then(function(){d.resolve()},function(){e.data.put(b).then(function(){f.countLastAdded++,d.resolve()})})}),a.all(c).then(function(){d.resolve()})},function(){d.resolve(0)}),d.promise}}}function e(a,b,c,d){return{pageChannels:function(c){var d=a.defer(),e=this;return typeof c=="undefined"&&(c=null),b.subscriptions(c).then(function(a){return e.loadChannels(a,c)}).then(function(){d.resolve()}),d.promise},loadChannels:function(b,c){var d=a.defer(),e=this;return typeof c=="undefined"&&(c=""),typeof b.items!="undefined"?e.appendChannels(b.items).then(function(){b.nextPageToken!=c?e.pageChannels(b.nextPageToken).then(function(){d.resolve()}):d.resolve()}):d.resolve(),d.promise},appendChannels:function(b){var c=[];return angular.forEach(b,function(b){var e=a.defer();c.push(e),d.data.get(b._id).then(function(){e.resolve()},function(){d.data.put(b).then(function(){e.resolve()})})}),a.all(c)}}}angular.module("sanityData",["youtube","pouchdb"]),a.$inject=["$rootScope","$q","ytData","accounts","videos","channels","archive","trash"],angular.module("sanityData").service("connection",a),b.$inject=["$rootScope","$q","accounts","videos","channels"],angular.module("sanityData").service("data",b),c.$inject=["$q","ytData","pouchDB"],angular.module("sanityData").service("accounts",c),d.$inject=["$q","$rootScope","ytData","pouchDB","accounts","channels"],angular.module("sanityData").service("videos",d),e.$inject=["$q","ytData","pouchDB","accounts"],angular.module("sanityData").service("channels",e)}(),function(){function a(a,b){a.otherwise("/ready"),b.state("ready",{url:"/ready",views:{main:{templateUrl:"templates/start.html"}}}).state("list",{url:"/list",views:{main:{templateUrl:"templates/videos.html"},footer:{templateUrl:"templates/footer.html"}}})}function b(a){a.apiReady=!0,$.isEmptyObject(a.settings)&&(a.settings={hidewatched:!1,hidemuted:!0,theme:"default"}),typeof a.videos=="object"&&(a.videos=[]),$.isEmptyObject(a.channelstate)&&(a.channelstate={},a.channelstate.hidden={},a.channelstate.zipped={}),$.isEmptyObject(a.filters)&&(a.filters={},a.filters.count=0,a.filters.caught=0,a.filters.global=[]),typeof a.filters.global=="undefined"&&(a.filters={},a.filters.count=0,a.filters.caught=0,a.filters.global=[],a.filters.channels={}),typeof a.filters.channels=="undefined"&&(a.filters.channels={}),$.isArray(a.videocache)&&(a.videocache={}),typeof a.settings.adblocksecret=="undefined"&&(a.settings.adblocksecret=Math.random().toString(36).substr(2),a.settings.adblockoverride=!1),typeof a.settings.videolimit=="undefined"&&(a.settings.videolimit=100)}function c(a,b,c,d){a.gotimelist=["YEAH BOIIIII!!!","Well, if you say so, I guess...","My body is ready for sanity!","Let's go!","Jeez, enough with the buttons already"];var e=Math.floor(Math.random()*a.gotimelist.length);a.gotime=a.gotimelist[e],a.startlinelist=["It's substantially more pleasant than a good, hard slap in the face","It almost certainly cannot give you, like, any tangible disease","Just like your extensive YouTube habit, it's totally not at all an unlimited source of self-loathing for its author","Nobody technically forces you to use it, which is cool, I guess"],e=Math.floor(Math.random()*a.startlinelist.length),a.startline=a.startlinelist[e],a.connect=function(){d.authorize().then(function(){c.go("list")})},b.userid&&(a.start=!1,b.settings.sidebar=!1,d.checkAuth().then(function(){c.go("list")}))}function d(a,b,c,d,e,f,g,h,i){var j=function(){var c=f.defer();return a.settings.sidebar=!1,h.init().then(function(){g.ready(),i.load(b).then(function(){b.videos=i.list,a.$on("videos:updated",function(a,c){b.videos=i.list}),g.loading(),h.update().then(function(){c.resolve()})})},function(){c.reject()}),c.promise},k=function(){a.settings.sidebar===!0?$(".sidebar").css({height:d.height()}):$(".sidebar").css({height:"40px"})};b.hideChannel=function(b){var c=$.inArray(b,a.channeloptions.hidden);c!=-1?a.channeloptions.hidden=a.channeloptions.hidden.splice(c,1):a.channeloptions.hidden.push(b)},b.togglesidebar=function(){a.settings.sidebar=!a.settings.sidebar,k()},b.videoFilter=function(b){if(a.channelstate.hidden[b.channelId]==="1")return null;var c=!1;return $.each(a.filters.global,function(a,d){b.title.indexOf(d.string)!=-1&&(c=!0)}),b},b.setLimit=function(b){a.settings.videolimit=Number(a.settings.videolimit)+Number(b),a.settings.videolimit<1&&(a.settings.videolimit=5)},b.percentage=0,b.abslength=0;var l=function(){a.settings.videolimit<b.videos.length?(b.percentage=parseInt(100*a.settings.videolimit/b.videos.length),b.abslength=a.settings.videolimit):(b.percentage=100,b.abslength=b.videos.length)};e(function(){g.loading(),j().then(function(){b.$watch("videos",l,!0),b.$watch("settings",l,!0),b.percentage=l(),g.ready(),k()},function(){c.go("ready")})},50)}function e(a,b,c,d,e,f,g){b.backToStart=function(a){d.go("ready")},b.refresh=function(){e.loading(),e.update(),f.update().then(function(){e.ready()})},b.hideChannel=function(b){var c=$.inArray(b,a.channeloptions.hidden);c!=-1?a.channeloptions.hidden=a.channeloptions.hidden.splice(c,1):a.channeloptions.hidden.push(b)},b.togglesidebar=function(){a.settings.sidebar=!a.settings.sidebar,updateSidebar()},angular.element(c).bind("keyup",function(a){a.which===82&&b.refresh()})}function f(a,b){b.cancel=function(){b.$hide()},b.redoadblocksecret=function(){a.settings.adblocksecret=Math.random().toString(36).substr(2)},b.removeFilter=function(b,c){b.length?(a.filters.channels[b].filters.splice(c,1),a.filters.channels[b].filters.length===0&&delete a.filters.channels[b]):a.filters.global.splice(c,1),a.filters.count--}}function g(a,b){b.video.authorid?b.filter={title:b.video.title,channel:b.video.authorid,author:b.video.author,authorid:b.video.authorid}:b.filter={title:b.video.title,channel:b.video.author,author:b.video.author,authorid:b.video.author},b.cancel=function(){b.$hide()},b.ok=function(){b.filter.channel.length?(typeof a.filters.channels[b.filter.channel]=="undefined"&&(a.filters.channels[b.filter.channel]={title:b.filter.channel,filters:[]}),a.filters.channels[b.filter.channel].filters.push({string:b.filter.title})):a.filters.global.push({string:b.filter.title}),a.filters.count++,b.$hide()}}function h(a){a.tabs=[],a.navType="pills",a.adblockadvice="firefox",a.adblockswitch=function(b){a.adblockadvice=b}}function i(a){a.oneAtATime=!0}function j(a,b){var c=function(a,b){var c=a.split("."),d=b.split(".");for(var e=0;e<c.length;++e)if(c[e]>d[e])return!0;return!1},d;this.resetErrors=function(){if(b.forbidden==1||b.notfound==1)b.forbidden=0,b.notfound=0},this.appinfo=function(a){var b="info.json";$.getJSON(b).fail(function(b,c,d){a(d,b.status)}).done(function(b){a(b,200)})},this.appupdates=function(a){var b=new Gh3.User("daviddeutsch"),c=new Gh3.Repository("yt-sanegrid",b);c.fetch(function(b,c){b&&a(b,500)}),c.fetchClosedIssues(function(b,d){b&&a(b,500),a(c.getIssues(),200)})},that=this,this.update=function(){that.appinfo(function(a,d){if(!c(a.version,b.info.version))return;b.info.update=a.version,b.info.updates.outdated=!0,b.info.updates.new=0,b.info.updates.title="Fresh Update(s)!",that.appupdates(function(a,c){b.info.updates.list=a,$.each(b.info.updates.list,function(a,c){var d=new Date(c.updated_at);d>b.info.date?(b.info.updates.list[a].new=!0,b.info.updates.new++):b.info.updates.list[a].new=!1})})})},this.appinfo(function(a,c){b.info={version:a.version,updates:{list:[]},date:new Date},that.appupdates(function(a,c){b.info.updates.list=a})}),this.loading=function(){clearTimeout(d),b.status=1},this.ready=function(a){function c(){b.status=0}clearTimeout(d),a=a===null?500:!1,a?d=setTimeout(c,a):c()}}function k(a){var b;return{nowTime:0,initted:!1,settings:{refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},doTimeout:function(){b.nowTime=(new Date).getTime(),a(b.doTimeout,b.settings.refreshMillis)},init:function(){this.initted===!1&&(this.initted=!0,this.nowTime=(new Date).getTime(),b=this,this.doTimeout(),this.initted=!0)},inWords:function(a){function j(c,d){var e=$.isFunction(c)?c(d,a):c,f=b.numbers&&b.numbers[d]||d;return e.replace(/%d/i,f)}var b=this.settings.strings,c=b.prefixAgo,d=b.suffixAgo;this.settings.allowFuture&&a<0&&(c=b.prefixFromNow,d=b.suffixFromNow);var e=Math.abs(a)/1e3,f=e/60,g=f/60,h=g/24,i=h/365,k=e<45&&j(b.seconds,Math.round(e))||e<90&&j(b.minute,1)||f<45&&j(b.minutes,Math.round(f))||f<90&&j(b.hour,1)||g<24&&j(b.hours,Math.round(g))||g<42&&j(b.day,1)||h<30&&j(b.days,Math.round(h))||h<45&&j(b.month,1)||h<365&&j(b.months,Math.round(h/30))||i<1.5&&j(b.year,1)||j(b.years,Math.round(i)),l=b.wordSeparator===undefined?" ":b.wordSeparator;return $.trim([c,k,d].join(l))}}}function l(){return function(a){var b=a.split("M");b[0]=Number(b[0].slice(2)),typeof b[1]=="undefined"?b[1]=0:b[1]=Number(b[1].slice(0,-1));var c=Math.floor(b[0]/60),d=Math.floor(b[0]%60),e=b[1];return(c>0?c+":":"")+(d>0?(c>0&&d<10?"0":"")+d+":":"00:")+(e<10?"0":"")+e}}function m(){return function(a){return(new Date(a)).getTime()}}function n(a,b){return{restrict:"C",scope:{video:"="},templateUrl:"templates/item.html",controller:function(c,d){c.mute=function(){c.video.doc.muted=!c.video.doc.muted,c.video.doc.muteddate=(new Date).toISOString(),b.data.update(c.video),b.data.put(c.video.doc,c.video._id,c.video._rev)},c.watch=function(b){if(b.button==2)return;a(function(){c.watched(!1)},400)},c.watched=function(a){if(c.video.doc.watched&&!a)return;c.video.doc.watched=!c.video.doc.watched,c.video.doc.watcheddate=(new Date).toISOString(),b.data.put(c.video.doc,c.video._id,c.video._rev)},d.settings.adblockoverride?c.link=c.video.doc.link+"&adblock="+d.settings.adblocksecret:c.link=c.video.doc.link}}}function o(a){return{replace:!0,restrict:"EA",scope:{fromTime:"@"},link:{post:function(b,c,d){b.timeago=a,b.timeago.init(),b.$watch("timeago.nowTime-fromTime",function(a){b.timeago.nowTime!==undefined&&(a=b.timeago.nowTime-b.fromTime,$(c).text(b.timeago.inWords(a)))})}}}}function p(){return function(a,b,c){b.bind("click",function(){this.select()})}}angular.module("sanityApp",["ngAnimate","ui.router","mgcrea.ngStrap","ngSocial","localStorage","googleAPI","sanityData"]),a.$inject=["$urlRouterProvider","$stateProvider"],angular.module("sanityApp").config(a),b.$inject=["$rootScope"],angular.module("sanityApp").run(b),c.$inject=["$scope","$rootScope","$state","googleApi"],angular.module("sanityApp").controller("StartCtrl",c),d.$inject=["$rootScope","$scope","$state","$document","$timeout","$q","sanityApp","data","videos"],angular.module("sanityApp").controller("AppRepeatCtrl",d),e.$inject=["$rootScope","$scope","$document","$state","sanityApp","data","videos"],angular.module("sanityApp").controller("FooterCtrl",e),f.$inject=["$rootScope","$scope"],angular.module("sanityApp").controller("SettingsModalCtrl",f),g.$inject=["$rootScope","$scope"],angular.module("sanityApp").controller("FilterModalCtrl",g),h.$inject=["$scope"],angular.module("sanityApp").controller("SettingsTabsCtrl",h),i.$inject=["$scope"],angular.module("sanityApp").controller("SettingsAccordionCtrl",i),j.$inject=["$q","$rootScope"],angular.module("sanityApp").service("sanityApp",j),k.$inject=["$timeout"],angular.module("sanityApp").service("timeAgo",k),angular.module("sanityApp").filter("duration",l),angular.module("sanityApp").filter("timestamp",m),n.$inject=["$timeout","videos"],angular.module("sanityApp").directive("videoItem",n),o.$inject=["timeAgo"],angular.module("sanityApp").directive("timeAgo",o),angular.module("sanityApp").directive("selectOnClick",p)}();